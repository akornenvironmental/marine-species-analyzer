<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marine Species Analyzer</title>
    <style>
        /* Theme styles */
        :root {
            --bg-color: #09306b;
            --text-color: #333;
            --card-bg: white;
            --border-color: #dee2e6;
            --accent-color: #2c5aa0;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --error-color: #dc3545;
            --light-bg: #f8f9fa;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e9ecef;
            --card-bg: #2d3748;
            --border-color: #4a5568;
            --accent-color: #63b3ed;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --error-color: #f56565;
            --light-bg: #2d3748;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Mobile disclaimer */
        .mobile-disclaimer {
            display: none;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            text-align: center;
            color: #856404;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .mobile-disclaimer {
                display: block;
            }
        }

        /* Results pagination */
        .results-pagination {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .pagination-label {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .pagination-select {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: 100vh;
        }

        /* AI Assistant Panel */
        .ai-assistant {
            width: 350px;
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .ai-body {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-intro {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border: 1px solid #5a7ba8;
            border-radius: 8px;
            padding: 15px;
        }

        .ai-intro p {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
            color: #333;
        }

        .ai-features {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .ai-features li {
            padding: 4px 0;
            font-size: 14px;
            color: #555;
            line-height: 1.3;
        }

        .ai-features li:before {
            content: "‚ñ∂ ";
            color: #5a7ba8;
            font-weight: bold;
            margin-right: 5px;
        }

        .ai-input-section {
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        .ai-input-box {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .ai-input-box:focus {
            outline: none;
            border-color: #5a7ba8;
            box-shadow: 0 0 5px rgba(90, 123, 168, 0.3);
        }

        .ai-send-button {
            width: 100%;
            background: linear-gradient(135deg, #209e5d, #1a7a47);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .ai-send-button:hover {
            background: linear-gradient(135deg, #1a7a47, #209e5d);
            transform: translateY(-1px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            min-height: 600px;
            height: auto;
        }

        .content-header {
            background: linear-gradient(135deg, var(--light-bg) 0%, var(--card-bg) 100%);
            border-bottom: 2px solid var(--border-color);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-main {
            flex: 1;
        }

        .header-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }

        .controls-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Theme Selector */
        .theme-selector {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .theme-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-color);
            transition: all 0.2s;
        }

        .theme-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .theme-btn:hover:not(.active) {
            background: var(--light-bg);
        }

        .lang-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-color);
            transition: all 0.2s;
        }

        .lang-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .lang-btn:hover:not(.active) {
            background: var(--light-bg);
        }

        .content-title h1 {
            font-size: 28px;
            color: var(--text-color);
            margin-bottom: 5px;
            font-weight: 700;
        }

        .content-title p {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 16px;
            font-weight: 400;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #e8f5e8;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #4caf50;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--light-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            flex: 1;
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.7;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            background: var(--card-bg);
            color: var(--accent-color);
            opacity: 1;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-color);
        }

        .tab-content {
            padding: 30px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Upload section */
        .upload-section {
            background: var(--light-bg);
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: var(--accent-color);
            background: var(--card-bg);
        }

        /* Processing steps */
        .processing-steps {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .step-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #6c757d;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 10px;
        }

        .step-card.active .step-number {
            background: var(--accent-color);
        }

        .step-title {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .step-description {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-title {
            font-size: 1.8rem;
            color: var(--text-color);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .results-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .stat-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .stat-verified {
            background: #d4edda;
            color: #155724;
        }

        .stat-synonyms {
            background: #fff3cd;
            color: #856404;
        }

        .stat-not-found {
            background: #f8d7da;
            color: #721c24;
        }

        /* Species cards */
        .species-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .species-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .species-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .species-card.verified {
            border-left: 4px solid #28a745;
        }

        .species-card.synonym {
            border-left: 4px solid #ffc107;
        }

        .species-card.not-found {
            border-left: 4px solid #dc3545;
        }

        .species-header {
            margin-bottom: 15px;
        }

        .species-name {
            font-style: italic;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .common-names {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-verified {
            background: #28a745;
            color: white;
        }

        .status-synonym {
            background: #ffc107;
            color: #212529;
        }

        .status-not-found {
            background: #dc3545;
            color: white;
        }

        /* Confidence bar */
        .confidence-section {
            margin: 15px 0;
        }

        .confidence-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .confidence-high {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .confidence-medium {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .confidence-low {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        /* Species details */
        .species-details {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .detail-grid {
            display: grid;
            gap: 8px;
        }

        .detail-row {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            align-items: start;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-color);
            white-space: nowrap;
        }

        .detail-value {
            color: var(--text-color);
            opacity: 0.8;
        }

        .citation {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .source-quote {
            font-style: italic;
            margin-top: 8px;
            padding: 8px 12px;
            background: var(--card-bg);
            border-left: 3px solid var(--border-color);
            border-radius: 0 4px 4px 0;
        }

        /* Table view */
        .species-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .species-table.active {
            display: table;
        }

        .species-table th,
        .species-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .species-table th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--text-color);
        }

        .species-table tbody tr:hover {
            background: var(--light-bg);
        }

        .species-table .scientific-name {
            font-style: italic;
            font-weight: 600;
            color: var(--accent-color);
        }

        /* Messages */
        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .message.warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        /* Language selection modal */
        .language-selection-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10003;
            animation: fadeIn 0.3s ease;
        }

        .language-selection-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .language-selection-header h2 {
            color: var(--accent-color);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .language-selection-header p {
            color: var(--text-color);
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .language-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .language-option {
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .language-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .language-option.selected {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .language-flag {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .language-name {
            font-weight: 600;
            font-size: 14px;
        }

        /* Legal Modal */
        .legal-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 10004;
            animation: fadeIn 0.3s ease;
        }

        .legal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .legal-content h3 {
            color: var(--accent-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .legal-content p, .legal-content li {
            color: var(--text-color);
            line-height: 1.6;
        }

        .legal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .legal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .legal-btn.primary {
            background: var(--success-color);
            color: white;
        }

        .legal-btn.primary:hover {
            background: #1e7e34;
            transform: translateY(-1px);
        }

        .legal-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .legal-btn.secondary:hover {
            background: #545b62;
        }

        /* Footer */
        .footer {
            background: var(--light-bg);
            border-top: 1px solid var(--border-color);
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }

        .footer a {
            color: var(--accent-color);
            text-decoration: none;
            margin: 0 10px;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }

            .ai-assistant {
                width: 100%;
                order: 2;
            }

            .species-grid {
                grid-template-columns: 1fr;
            }

            .processing-steps {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                align-items: stretch;
            }

            .tabs {
                flex-direction: column;
            }

            .language-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Disclaimer -->
    <div class="mobile-disclaimer">
        <strong>üì± Desktop Recommended</strong><br>
        This tool is optimized for desktop use. A mobile-friendly version will be available soon. For the best experience, please use a desktop or laptop computer.
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- AI Assistant Panel -->
        <div class="ai-assistant">
            <div class="ai-body">
                <div class="ai-intro">
                    <p><strong>ü§ñ Marine Species AI Helper</strong></p>
                    <ul class="ai-features">
                        <li>Help with PDF processing questions</li>
                        <li>Explain WoRMS verification results</li>
                        <li>Suggest fixes for unverified species</li>
                        <li>Generate species reports</li>
                        <li>Provide taxonomic guidance</li>
                        <li>Export data in various formats</li>
                        <li>Compare database matches</li>
                        <li>Improve OCR accuracy tips</li>
                    </ul>
                </div>
                <div class="ai-input-section">
                    <textarea class="ai-input-box" id="aiInput" placeholder="Ask me anything! For example: 'Why wasn't Mytilus californianus found?' or 'How can I improve OCR accuracy?'"></textarea>
                    <button class="ai-send-button" onclick="sendAIMessage()">Ask AI Helper</button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <div class="header-main">
                    <h1 style="font-size: 28px; color: var(--text-color); margin-bottom: 5px; font-weight: 700;">üêö Marine Species Analyzer</h1>
                    <p style="color: var(--text-color); opacity: 0.7; font-size: 16px; font-weight: 400; margin-bottom: 10px;">
                        Advanced AI-powered marine species identification and verification system
                    </p>
                    <p style="color: var(--text-color); opacity: 0.8; font-size: 14px; line-height: 1.4; max-width: 600px;">
                        Leverages cutting-edge OCR technology, natural language processing, and real-time access to four authoritative marine databases (WoRMS, GBIF, iNaturalist, OBIS) to extract, identify, and verify marine species from field guides and research documents with unprecedented accuracy and speed.
                    </p>
                </div>
                <div class="header-controls">
                    <div class="controls-row">
                        <!-- Theme Selector -->
                        <div class="theme-selector">
                            <span style="font-size: 12px; margin-right: 8px;">Theme:</span>
                            <button class="theme-btn active" onclick="setTheme('system')" data-theme="system">System</button>
                            <button class="theme-btn" onclick="setTheme('light')" data-theme="light">Light</button>
                            <button class="theme-btn" onclick="setTheme('dark')" data-theme="dark">Dark</button>
                        </div>
                    </div>
                    <div class="controls-row">
                        <!-- Language Selector -->
                        <div style="display: flex; gap: 5px;">
                            <button class="lang-btn active" onclick="setLanguage('en')" data-lang="en">English</button>
                            <button class="lang-btn" onclick="setLanguage('es')" data-lang="es">Espa√±ol</button>
                            <button class="lang-btn" onclick="setLanguage('fr')" data-lang="fr">Fran√ßais</button>
                        </div>
                    </div>
                    <div class="controls-row">
                        <!-- Status Indicator -->
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span>System Online</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload')">üìÑ Upload & Extract</button>
                <button class="tab" onclick="switchTab('results')">üìä Results & Verification</button>
                <button class="tab" onclick="switchTab('analytics')">üìà Analytics</button>
                <button class="tab" onclick="switchTab('help')" style="margin-left: auto;">‚ùì Help</button>
            </div>

            <!-- Upload Tab Content -->
            <div class="tab-content active" id="upload-content">
                <!-- Two-column layout for upload options -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- PDF Upload Section -->
                    <div class="upload-section" id="uploadSection" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)" 
                         ondrop="handleDrop(event)"
                         onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üìÑ</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-bottom: 8px;">Upload Marine Field Guide PDF</div>
                        <div style="color: var(--text-color); opacity: 0.7; margin-bottom: 20px;">Drag and drop your PDF here, or click to browse</div>
                        <button style="background: var(--accent-color); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
                            Choose PDF File
                        </button>
                        <input type="file" id="fileInput" style="display: none;" accept=".pdf" onchange="handleFileUpload(event)">
                        <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-color); opacity: 0.6;">
                            Maximum file size: 1GB ‚Ä¢ Files stored securely in Google Drive
                        </div>
                    </div>

                    <!-- Manual Species Entry Section -->
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <div style="font-size: 2rem;">üîç</div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-color);">Manual Species Lookup</h3>
                                <p style="margin: 5px 0 0 0; color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">Enter species names (scientific and/or common names) to verify against marine databases</p>
                            </div>
                        </div>
                        
                        <div>
                            
                            <textarea id="manualSpeciesInput" style="width: 100%; height: 150px; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-family: inherit; font-size: 14px; background: var(--card-bg); color: var(--text-color); resize: vertical;"
                                      placeholder="Enter species name(s) here, one per line or separated by commas"></textarea>
                            
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="processManualSpecies()" style="background: var(--accent-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                    üîç Verify Species
                                </button>
                                <button onclick="clearManualInput()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                    üóëÔ∏è Clear
                                </button>
                                <button onclick="loadSampleSpecies()" style="background: var(--success-color); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                    üìã Examples
                                </button>
                            </div>
                            
                            <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-color); opacity: 0.8;">
                                    <span>‚úÖ</span>
                                    <span>Accepts scientific & common names</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-color); opacity: 0.8;">
                                    <span>üîÑ</span>
                                    <span>Auto-resolves common to scientific names</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-color); opacity: 0.8;">
                                    <span>üåä</span>
                                    <span>Verifies against 4 marine databases</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OR Divider -->
                <div style="display: flex; align-items: center; margin: 30px 0;">
                    <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                    <span style="padding: 0 20px; color: var(--text-color); font-weight: 600; opacity: 0.7;">PROCESSING WORKFLOW</span>
                    <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                </div>

                <!-- Processing Steps -->
                <div class="processing-steps">
                    <div class="step-card" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-title">Input Processing</div>
                        <div class="step-description">Process PDF or manual species entries</div>
                    </div>
                    <div class="step-card" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-title">Species Parsing</div>
                        <div class="step-description">Extract and validate species names</div>
                    </div>
                    <div class="step-card" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-title">Name Resolution</div>
                        <div class="step-description">Resolve common names to scientific names</div>
                    </div>
                    <div class="step-card" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-title">Database Verification</div>
                        <div class="step-description">Verify against WoRMS, GBIF, iNaturalist & OBIS</div>
                    </div>
                    <div class="step-card" id="step5">
                        <div class="step-number">5</div>
                        <div class="step-title">Results Analysis</div>
                        <div class="step-description">Analyze verification results and confidence</div>
                    </div>
                </div>

                <div id="processingResults">
                    <!-- Processing messages will appear here -->
                </div>
            </div>

            <!-- Results Tab Content -->
            <div class="tab-content" id="results-content">
                <div class="results-header">
                    <div class="results-title">Species Verification Results</div>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('cards')">üìã Cards</button>
                        <button class="view-btn" onclick="setView('table')">üìä Table</button>
                    </div>
                </div>
                
                <div class="results-stats" id="resultsStats">
                    <span class="stat-badge stat-verified" id="verifiedCount">0 Verified</span>
                    <span class="stat-badge stat-synonyms" id="synonymCount">0 Synonyms</span>
                    <span class="stat-badge stat-not-found" id="notFoundCount">0 Not Found</span>
                </div>

                <!-- Results Pagination -->
                <div class="results-pagination">
                    <span class="pagination-label">Show:</span>
                    <select class="pagination-select" id="resultsPerPage" onchange="updateResultsDisplay()">
                        <option value="20">20 species</option>
                        <option value="50">50 species</option>
                        <option value="100">100 species</option>
                        <option value="all">All species</option>
                    </select>
                    <span class="pagination-label" id="resultsInfo">Showing 0 of 0 species</span>
                </div>
                
                <!-- Cards View -->
                <div class="species-grid" id="speciesGrid">
                    <!-- Species cards will be populated here -->
                </div>

                <!-- Table View -->
                <div style="overflow-x: auto; display: none;" id="tableView">
                    <table class="species-table" id="speciesTable">
                        <thead>
                            <tr>
                                <th>Scientific Name</th>
                                <th>Common Name(s)</th>
                                <th>Status</th>
                                <th>Confidence</th>
                                <th>Size (Standard)</th>
                                <th>Habitat</th>
                                <th>Source</th>
                                <th>Page(s)</th>
                            </tr>
                        </thead>
                        <tbody id="speciesTableBody">
                            <!-- Table rows will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                    <button onclick="exportToCSV()" style="background: var(--success-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">üìä Export CSV</button>
                    <button onclick="exportToExcel()" style="background: var(--accent-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">üìà Export Excel</button>
                    <button onclick="generateReport()" style="background: var(--warning-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">üìã Generate Report</button>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" id="analytics-content">
                <h2>Verification Analytics</h2>
                
                <!-- Compact Analytics Dashboard -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--accent-color); font-weight: bold;" id="totalProcessed">0</div>
                        <div style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">Total Species</div>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--success-color); font-weight: bold;" id="successRate">0%</div>
                        <div style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">Success Rate</div>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; color: #17a2b8; font-weight: bold;" id="avgConfidence">0%</div>
                        <div style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">Avg Confidence</div>
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; color: var(--warning-color); font-weight: bold;" id="needsReview">0</div>
                        <div style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">Need Review</div>
                    </div>
                </div>

                <!-- Database Coverage -->
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--text-color);">üóÑÔ∏è Database Coverage</h3>
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>WoRMS:</strong> <span id="wormsDetails">0 species</span></span>
                            <span id="wormsPercent" style="font-weight: bold; color: var(--success-color);">0%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>GBIF:</strong> <span id="gbifDetails">0 species</span></span>
                            <span id="gbifPercent" style="font-weight: bold; color: #007bff;">0%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>iNaturalist:</strong> <span id="inatDetails">0 species</span></span>
                            <span id="inatPercent" style="font-weight: bold; color: #6f42c1;">0%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>OBIS:</strong> <span id="obisDetails">0 species</span></span>
                            <span id="obisPercent" style="font-weight: bold; color: #20c997;">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Confidence Distribution -->
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--text-color);">üìä Confidence Distribution</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);" id="excellentCount">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">Excellent (80%+)</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #17a2b8;" id="goodCount">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">Good (60-79%)</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);" id="fairCount">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">Fair (40-59%)</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--error-color);" id="poorCount">0</div>
                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">Poor (0-39%)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help Tab -->
            <div class="tab-content" id="help-content">
                <h2>User Guide & Documentation</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- Quick Start -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>üöÄ Quick Start</h3>
                        <ol style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Upload PDF:</strong> Drag and drop a marine field guide or species list PDF</li>
                            <li><strong>Wait for Processing:</strong> OCR extracts text and AI parses species names</li>
                            <li><strong>Review Results:</strong> Check verification results in the Results tab</li>
                            <li><strong>Export Data:</strong> Download CSV or generate reports for analysis</li>
                        </ol>
                    </div>

                    <!-- Common Issues -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>‚ö†Ô∏è Common Issues</h3>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Species Not Found:</strong> Check spelling, try common names, or verify it's a marine species</li>
                            <li><strong>Low Confidence:</strong> May indicate taxonomic uncertainty or data quality issues</li>
                            <li><strong>PDF Processing Slow:</strong> Large files (>100MB) may take several minutes</li>
                            <li><strong>Missing Species:</strong> OCR may miss faint text or unusual formatting</li>
                        </ul>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- Databases -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>üóÑÔ∏è Databases Used</h3>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>WoRMS:</strong> World Register of Marine Species (authoritative taxonomy)</li>
                            <li><strong>GBIF:</strong> Global Biodiversity Information Facility (occurrence data)</li>
                            <li><strong>iNaturalist:</strong> Citizen science observations and photos</li>
                            <li><strong>OBIS:</strong> Ocean Biodiversity Information System (marine-specific data)</li>
                        </ul>
                    </div>

                    <!-- Best Practices -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>‚úÖ Best Practices</h3>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>File Quality:</strong> Use high-resolution PDFs with clear text</li>
                            <li><strong>Manual Review:</strong> Always verify results against authoritative sources</li>
                            <li><strong>Data Export:</strong> Export results before closing browser</li>
                            <li><strong>Large Files:</strong> Split very large PDFs for faster processing</li>
                        </ul>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- Standardized Units -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>üìè Standardized Units</h3>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Size:</strong> Converted to meters (m) for length, kilograms (kg) for weight</li>
                            <li><strong>Depth:</strong> Converted to meters (m) below sea level</li>
                            <li><strong>Temperature:</strong> Converted to Celsius (¬∞C)</li>
                            <li><strong>Original values:</strong> Always displayed alongside standardized units</li>
                        </ul>
                    </div>

                    <!-- Data Interpretation -->
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                        <h3>üìä Data Interpretation</h3>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Verified (Green):</strong> Found in primary databases with high confidence</li>
                            <li><strong>Synonym (Yellow):</strong> Valid name but may have taxonomic synonyms</li>
                            <li><strong>Not Found (Red):</strong> Not located in marine databases - check spelling</li>
                            <li><strong>Confidence %:</strong> Based on database matches and data quality</li>
                        </ul>
                    </div>
                </div>

                <!-- Screenshots Section -->
                <div style="background: var(--light-bg); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <h3>üì∏ Tool Screenshots</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                        <div style="text-align: center;">
                            <div style="background: var(--card-bg); border: 2px solid var(--border-color); border-radius: 8px; padding: 20px; min-height: 150px; display: flex; align-items: center; justify-content: center; color: var(--text-color); opacity: 0.7;">
                                <div>
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üìä</div>
                                    <div style="font-size: 14px;">Results Dashboard</div>
                                    <div style="font-size: 12px; margin-top: 5px;">Species verification with confidence scores</div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="background: var(--card-bg); border: 2px solid var(--border-color); border-radius: 8px; padding: 20px; min-height: 150px; display: flex; align-items: center; justify-content: center; color: var(--text-color); opacity: 0.7;">
                                <div>
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üìà</div>
                                    <div style="font-size: 14px;">Analytics View</div>
                                    <div style="font-size: 12px; margin-top: 5px;">Database coverage and success metrics</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-color); opacity: 0.8; text-align: center; margin-top: 10px;">
                        <em>Note: Screenshots will be added in the next version update</em>
                    </p>
                </div>

                <!-- Video Tutorial -->
                <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); border: 1px solid #b3d9ff; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">üé• Video Tutorial</h3>
                    <div style="text-align: center; padding: 40px; background: var(--card-bg); border-radius: 8px; border: 2px dashed var(--border-color);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üé¨</div>
                        <h4 style="margin-bottom: 10px; color: var(--text-color);">Complete Walkthrough</h4>
                        <p style="color: var(--text-color); opacity: 0.7; margin-bottom: 15px;">
                            5-minute video showing PDF upload, species verification, and data export
                        </p>
                        <button onclick="alert('Video tutorial coming soon!')" style="background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            üì∫ Watch Tutorial (Coming Soon)
                        </button>
                    </div>
                </div>
                <!-- Contact Support -->
                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%); border: 1px solid #2196f3; border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">üìß Need Help?</h3>
                    <p style="margin-bottom: 15px; line-height: 1.6;">
                        Having issues or questions about the Marine Species Analyzer? Our team is here to help!
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin-bottom: 10px;">üî¨ Technical Support</h4>
                            <button onclick="sendSupportEmail('technical')" style="background: #2196f3; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%;">
                                Email Aaron Kornbluth
                            </button>
                            <p style="font-size: 0.9rem; margin-top: 8px; opacity: 0.8;">Marine biology expertise, tool functionality</p>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">üíª Development Support</h4>
                            <button onclick="sendSupportEmail('development')" style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; width: 100%;">
                                Email Jake Spencer
                            </button>
                            <p style="font-size: 0.9rem; margin-top: 8px; opacity: 0.8;">Bug reports, feature requests</p>
                        </div>
                    </div>
                </div>

                <!-- Keyboard Shortcuts -->
                <div style="background: var(--light-bg); padding: 20px; border-radius: 12px;">
                    <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                        <div>
                            <ul style="list-style: none; padding: 0; line-height: 1.8;">
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + U</kbd> - Upload Tab</li>
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + R</kbd> - Results Tab</li>
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + A</kbd> - Analytics Tab</li>
                            </ul>
                        </div>
                        <div>
                            <ul style="list-style: none; padding: 0; line-height: 1.8;">
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + E</kbd> - Export CSV</li>
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + G</kbd> - Generate Report</li>
                                <li><kbd style="background: var(--card-bg); padding: 2px 6px; border: 1px solid var(--border-color); border-radius: 3px;">Ctrl/Cmd + H</kbd> - Help Tab</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div style="max-width: 1400px; margin: 0 auto;">
            <a href="https://akornenvironmental.com/privacy" target="_blank">Privacy Policy</a>
            <a href="https://akornenvironmental.com/terms" target="_blank">Terms of Service</a>
            <a href="mailto:aaron.kornbluth@gmail.com">Contact</a>
            <a href="#" onclick="showLegalModal()">Legal Disclaimer</a>
        </div>
    </div>

    <!-- Language Selection Modal -->
    <div id="languageModal" class="language-selection-modal">
        <div class="language-selection-content">
            <div class="language-selection-header">
                <h2>üåç Welcome / Bienvenido / Bienvenue</h2>
                <p>Please select your preferred language / Seleccione su idioma / S√©lectionnez votre langue</p>
            </div>
            <div class="language-options">
                <div class="language-option selected" onclick="selectLanguage('en')" data-lang="en">
                    <span class="language-flag">üá∫üá∏</span>
                    <div class="language-name">English</div>
                </div>
                <div class="language-option" onclick="selectLanguage('es')" data-lang="es">
                    <span class="language-flag">üá™üá∏</span>
                    <div class="language-name">Espa√±ol</div>
                </div>
                <div class="language-option" onclick="selectLanguage('fr')" data-lang="fr">
                    <span class="language-flag">üá´üá∑</span>
                    <div class="language-name">Fran√ßais</div>
                </div>
            </div>
            <button class="legal-btn primary" onclick="confirmLanguageSelection()">Continue / Continuar / Continuer</button>
        </div>
    </div>

    <!-- Legal Disclaimer Modal -->
    <div id="legalModal" class="legal-modal">
        <div class="legal-content">
            <h3>‚öñÔ∏è Legal Disclaimer & Terms of Use</h3>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                <p><strong>Before proceeding, please acknowledge:</strong></p>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li><strong>File Handling:</strong> PDFs are uploaded to Google Drive, processed, and automatically deleted after 30 days</li>
                    <li><strong>Research Tool:</strong> Results are for research/educational use only - verify with authoritative sources</li>
                    <li><strong>No Warranty:</strong> Tool provided "as is" - users responsible for validating outputs</li>
                    <li><strong>Copyright:</strong> Users must own or have rights to upload PDFs</li>
                    <li><strong>Large Files:</strong> 1GB max upload - processing may take several minutes</li>
                    <li><strong>Data Security:</strong> Files processed securely but users should not upload sensitive/classified materials</li>
                </ul>
                <p style="margin-top: 20px;"><strong>By clicking "I Agree," you accept these terms and our data handling practices.</strong></p>
            </div>
            <div class="legal-buttons">
                <button class="legal-btn primary" onclick="acceptLegalTerms()">I Agree & Continue</button>
                <button class="legal-btn secondary" onclick="declineLegalTerms()">Decline</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let speciesData = [];
        let currentLanguage = 'en';
        let currentView = 'cards';
        let uploadedPDFInfo = null;
        let currentPage = 1;
        let resultsPerPage = 20;

        // Configuration
        const CONFIG = {
            MAX_FILE_SIZE: 1024 * 1024 * 1024, // 1GB
            CHUNK_SIZE: 10 * 1024 * 1024, // 10MB chunks
            SUPPORTED_TYPES: ['application/pdf']
        };

        // Sample data
        const SAMPLE_DATA = {
            species: `Mytilus californianus, California mussel, Sebastes mystinus, Blue rockfish, Haliotis rufescens, Red abalone, Pisaster ochraceus, Purple sea star`
        };

        // Initialize app with theme and language selection
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            checkLanguageAndLegalAcceptance();
        });

        function initializeTheme() {
            const savedTheme = localStorage.getItem('msa_theme') || 'system';
            setTheme(savedTheme);
        }

        function setTheme(theme) {
            // Update active theme button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const themeBtn = document.querySelector(`[data-theme="${theme}"]`);
            if (themeBtn) themeBtn.classList.add('active');
            
            // Apply theme
            if (theme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            
            localStorage.setItem('msa_theme', theme);
        }

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            const currentTheme = localStorage.getItem('msa_theme');
            if (currentTheme === 'system') {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });

        function checkLanguageAndLegalAcceptance() {
            const languageSelected = localStorage.getItem('msa_language_selected');
            const legalAccepted = localStorage.getItem('msa_legal_accepted');
            
            if (!languageSelected) {
                showLanguageSelection();
            } else if (!legalAccepted) {
                showLegalModal();
            } else {
                initializeApp();
            }
        }

        function showLanguageSelection() {
            document.getElementById('languageModal').style.display = 'block';
        }

        function selectLanguage(lang) {
            // Update selected language option
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-lang="${lang}"]`).classList.add('selected');
            
            // Store selection temporarily
            window.selectedLanguage = lang;
        }

        function confirmLanguageSelection() {
            const selectedLang = window.selectedLanguage || 'en';
            localStorage.setItem('msa_language_selected', 'true');
            localStorage.setItem('msa_current_language', selectedLang);
            
            // Set the language
            setLanguage(selectedLang);
            
            // Hide language modal and show legal modal
            document.getElementById('languageModal').style.display = 'none';
            showLegalModal();
        }

        function showLegalModal() {
            document.getElementById('legalModal').style.display = 'block';
        }

        function acceptLegalTerms() {
            localStorage.setItem('msa_legal_accepted', 'true');
            localStorage.setItem('msa_legal_date', new Date().toISOString());
            document.getElementById('legalModal').style.display = 'none';
            initializeApp();
        }

        function declineLegalTerms() {
            alert('You must accept the terms to use this tool.');
            window.location.href = 'https://akornenvironmental.com';
        }

        function initializeApp() {
            console.log('Marine Species Analyzer initialized');
            
            // Load saved language or default to system language
            const savedLanguage = localStorage.getItem('msa_current_language') || 'en';
            setLanguage(savedLanguage);
        }

        // Language functions
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update active button in top nav
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const langBtn = document.querySelector(`.lang-btn[data-lang="${lang}"]`);
            if (langBtn) langBtn.classList.add('active');
            
            // Save language preference
            localStorage.setItem('msa_current_language', lang);
            
            updateLanguage();
        }

        function updateLanguage() {
            // Translation functionality would go here
            console.log('Language updated to:', currentLanguage);
        }

        // Tab navigation
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // Add active class to clicked tab
            event.target.classList.add('active');

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            // Show selected tab content
            const selectedTab = document.getElementById(`${tabName}-content`);
            selectedTab.classList.add('active');
            selectedTab.style.display = 'block';
        }

        // View toggle for results
        function setView(viewType) {
            currentView = viewType;
            
            // Update button styles
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (viewType === 'cards') {
                document.getElementById('speciesGrid').style.display = 'grid';
                document.getElementById('tableView').style.display = 'none';
            } else {
                document.getElementById('speciesGrid').style.display = 'none';
                document.getElementById('tableView').style.display = 'block';
            }
        }

        // Results pagination and display
        function updateResultsDisplay() {
            const selector = document.getElementById('resultsPerPage');
            resultsPerPage = selector.value === 'all' ? speciesData.length : parseInt(selector.value);
            currentPage = 1;
            populateResults();
        }

        function getDisplayedSpecies() {
            if (resultsPerPage === 'all' || resultsPerPage >= speciesData.length) {
                return speciesData;
            }
            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            return speciesData.slice(startIndex, endIndex);
        }

        // File upload handlers
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.style.borderColor = 'var(--accent-color)';
            event.currentTarget.style.background = 'var(--card-bg)';
        }

        function handleDragLeave(event) {
            event.currentTarget.style.borderColor = 'var(--border-color)';
            event.currentTarget.style.background = 'var(--light-bg)';
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.style.borderColor = 'var(--border-color)';
            event.currentTarget.style.background = 'var(--light-bg)';
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        async function processFile(file) {
            if (!validateFile(file)) return;

            try {
                showProcessingMessage('Starting file upload...', 'info');
                
                // Show file size info for large files
                const fileSizeMB = Math.round(file.size / (1024 * 1024));
                if (fileSizeMB > 100) {
                    showProcessingMessage(`Uploading large file (${fileSizeMB}MB)... This may take several minutes.`, 'info');
                }
                
                // Simulate processing
                await processStandardFile(file);
                
            } catch (error) {
                showMessage('Error processing file: ' + error.message, 'error');
            }
        }

        async function processStandardFile(file) {
            try {
                // Step 1: Extract text
                showProcessingMessage('üìÑ Extracting text from PDF...', 'info');
                updateProcessingStep(1);
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 2: Parse species
                showProcessingMessage('ü§ñ Parsing species information...', 'info');
                updateProcessingStep(2);
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 3: Name resolution
                showProcessingMessage('üîÑ Resolving species names...', 'info');
                updateProcessingStep(3);
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 4: Database verification
                showProcessingMessage('üåä Verifying with databases...', 'info');
                updateProcessingStep(4);
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Step 5: Analysis
                showProcessingMessage('üìä Analyzing results...', 'info');
                updateProcessingStep(5);
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Create sample results
                const sampleData = createSampleData(file.name);
                speciesData = sampleData;
                
                uploadedPDFInfo = {
                    originalName: file.name,
                    processed: new Date()
                };
                
                showMessage(`Processing complete! Found ${speciesData.length} species.`, 'success');
                populateResults();
                updateAnalytics();
                
                // Switch to results tab
                setTimeout(() => {
                    // Simulate click on results tab
                    const resultsTab = document.querySelector('[onclick="switchTab(\'results\')"]');
                    resultsTab.click();
                }, 1000);
                
            } catch (error) {
                console.error('Error in processStandardFile:', error);
                showMessage('Error processing file: ' + error.message, 'error');
            }
        }

        function updateProcessingStep(stepNumber) {
            // Reset all steps
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active');
                const stepNum = card.querySelector('.step-number');
                if (stepNum) {
                    stepNum.style.background = '#6c757d';
                }
            });
            
            // Activate current and previous steps
            for (let i = 1; i <= stepNumber; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) {
                    step.classList.add('active');
                    const stepNum = step.querySelector('.step-number');
                    if (stepNum) {
                        stepNum.style.background = 'var(--accent-color)';
                    }
                }
            }
        }

        function validateFile(file) {
            if (file.size > CONFIG.MAX_FILE_SIZE) {
                showMessage(`File too large. Maximum size is ${CONFIG.MAX_FILE_SIZE / (1024 * 1024 * 1024)}GB`, 'error');
                return false;
            }

            if (!CONFIG.SUPPORTED_TYPES.includes(file.type)) {
                showMessage('Please upload a PDF file only.', 'error');
                return false;
            }

            return true;
        }

        function createSampleData(fileName) {
            return [
                {
                    scientificName: 'Mytilus californianus',
                    commonNames: ['California mussel', 'Pacific blue mussel'],
                    status: 'verified',
                    confidence: 92,
                    author: 'Conrad',
                    year: '1837',
                    originalSize: 'To 25 cm',
                    standardizedSize: { value: 0.25, unit: 'm', original: 'To 25 cm' },
                    habitat: 'Rocky intertidal zones, attached to rocks and pier pilings',
                    distribution: 'British Columbia to Baja California',
                    description: 'Large, dark blue to black mussel with strong shell ridges.',
                    sourceFile: fileName,
                    sourcePage: '1',
                    sourceQuote: 'The largest mussel on the Pacific Coast, forming dense beds in the mid to low intertidal zone.',
                    citation: 'Pacific Coast Field Guide',
                    sourceUrl: '',
                    verification: {
                        status: 'VERIFIED',
                        confidence: 92,
                        databases: ['WoRMS', 'GBIF', 'iNaturalist', 'OBIS']
                    }
                },
                {
                    scientificName: 'Sebastes mystinus',
                    commonNames: ['Blue rockfish', 'Priestfish'],
                    status: 'verified',
                    confidence: 88,
                    author: 'Jordan & Gilbert',
                    year: '1881',
                    originalSize: 'To 60 cm',
                    standardizedSize: { value: 0.6, unit: 'm', original: 'To 60 cm' },
                    habitat: 'Rocky reefs and kelp forests, 10-300 feet depth',
                    distribution: 'British Columbia to Baja California',
                    description: 'Blue to black coloration with lighter mottling on sides.',
                    sourceFile: fileName,
                    sourcePage: '2',
                    sourceQuote: 'Common in kelp forests and around rocky reefs.',
                    citation: 'Pacific Coast Field Guide',
                    sourceUrl: '',
                    verification: {
                        status: 'VERIFIED',
                        confidence: 88,
                        databases: ['WoRMS', 'GBIF', 'iNaturalist']
                    }
                },
                {
                    scientificName: 'Haliotis rufescens',
                    commonNames: ['Red abalone'],
                    status: 'verified',
                    confidence: 95,
                    author: 'Swainson',
                    year: '1822',
                    originalSize: 'To 30 cm',
                    standardizedSize: { value: 0.3, unit: 'm', original: 'To 30 cm' },
                    habitat: 'Rocky subtidal areas, kelp forests',
                    distribution: 'Oregon to Baja California',
                    description: 'Largest abalone species, with distinctive red-brown shell.',
                    sourceFile: fileName,
                    sourcePage: '3',
                    sourceQuote: 'The largest abalone species on the Pacific Coast.',
                    citation: 'Pacific Coast Field Guide',
                    sourceUrl: '',
                    verification: {
                        status: 'VERIFIED',
                        confidence: 95,
                        databases: ['WoRMS', 'GBIF', 'iNaturalist', 'OBIS']
                    }
                },
                {
                    scientificName: 'Pisaster ochraceus',
                    commonNames: ['Purple sea star', 'Ochre star'],
                    status: 'synonym',
                    confidence: 78,
                    author: 'Brandt',
                    year: '1835',
                    originalSize: 'To 35 cm diameter',
                    standardizedSize: { value: 0.35, unit: 'm', original: 'To 35 cm diameter' },
                    habitat: 'Rocky intertidal zones',
                    distribution: 'Alaska to Baja California',
                    description: 'Purple to orange sea star, keystone predator.',
                    sourceFile: fileName,
                    sourcePage: '4',
                    sourceQuote: 'Keystone species that controls mussel populations.',
                    citation: 'Pacific Coast Field Guide',
                    sourceUrl: '',
                    verification: {
                        status: 'SYNONYM',
                        confidence: 78,
                        databases: ['WoRMS', 'iNaturalist']
                    }
                }
            ];
        }

        // Manual species processing functions
        function processManualSpecies() {
            const input = document.getElementById('manualSpeciesInput').value.trim();
            if (!input) {
                showMessage('Please enter some species names first.', 'warning');
                return;
            }

            // Parse species names from input
            const lines = input.split('\n').filter(line => line.trim());
            const species = lines.map((line, index) => {
                const trimmed = line.trim();
                // Simple parsing - assume scientific name if it has two words, otherwise common name
                const words = trimmed.split(' ');
                if (words.length >= 2 && words[0][0].toUpperCase() === words[0][0]) {
                    return {
                        scientificName: trimmed,
                        genus: words[0],
                        species: words[1],
                        commonName: '',
                        sourcePage: 'Manual Entry'
                    };
                } else {
                    return {
                        scientificName: `Unknown species ${index + 1}`,
                        genus: 'Unknown',
                        species: 'species',
                        commonName: trimmed,
                        sourcePage: 'Manual Entry'
                    };
                }
            });

            // Process the species
            processSpeciesList(species);
        }

        function clearManualInput() {
            document.getElementById('manualSpeciesInput').value = '';
        }

        function loadSampleSpecies() {
            document.getElementById('manualSpeciesInput').value = SAMPLE_DATA.species;
        }

        async function processSpeciesList(species) {
            try {
                showProcessingMessage('üîç Processing species names...', 'info');
                updateProcessingStep(2);
                
                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                updateProcessingStep(4);
                showProcessingMessage('üåä Verifying with databases...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Create mock verification results
                const results = species.map((sp, index) => ({
                    scientificName: sp.scientificName,
                    commonNames: sp.commonName ? [sp.commonName] : ['Common name'],
                    status: Math.random() > 0.3 ? 'verified' : (Math.random() > 0.5 ? 'synonym' : 'not-found'),
                    confidence: Math.floor(Math.random() * 40) + 60, // 60-100%
                    author: 'Author',
                    year: '2020',
                    originalSize: 'Variable',
                    standardizedSize: { value: Math.random() * 0.5, unit: 'm', original: 'Variable' },
                    habitat: 'Marine environment',
                    distribution: 'Pacific Ocean',
                    description: 'A marine species.',
                    sourceFile: 'Manual Entry',
                    sourcePage: sp.sourcePage || 'Manual',
                    sourceQuote: '',
                    citation: 'Manual Entry',
                    sourceUrl: '',
                    verification: {
                        status: 'VERIFIED',
                        confidence: Math.floor(Math.random() * 40) + 60,
                        databases: ['WoRMS']
                    }
                }));
                
                // Store results
                speciesData = results;
                updateProcessingStep(5);
                
                showMessage(`Processing complete! Found ${speciesData.length} species.`, 'success');
                populateResults();
                updateAnalytics();
                
                // Switch to results tab
                setTimeout(() => {
                    const resultsTab = document.querySelector('[onclick="switchTab(\'results\')"]');
                    resultsTab.click();
                }, 500);
                
            } catch (error) {
                console.error('Error processing species:', error);
                showMessage('Error processing species: ' + error.message, 'error');
            }
        }

        function populateResults() {
            updateResultsStats();
            updateResultsInfo();
            populateSpeciesCards();
            populateSpeciesTable();
        }

        function updateResultsInfo() {
            const info = document.getElementById('resultsInfo');
            if (info) {
                const displayedCount = getDisplayedSpecies().length;
                const totalCount = speciesData.length;
                info.textContent = `Showing ${displayedCount} of ${totalCount} species`;
            }
        }

        function populateSpeciesCards() {
            const grid = document.getElementById('speciesGrid');
            grid.innerHTML = '';

            const displayedSpecies = getDisplayedSpecies();
            displayedSpecies.forEach(species => {
                const card = createSpeciesCard(species);
                grid.appendChild(card);
            });
        }

        function populateSpeciesTable() {
            const tbody = document.getElementById('speciesTableBody');
            tbody.innerHTML = '';

            const displayedSpecies = getDisplayedSpecies();
            displayedSpecies.forEach(species => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="scientific-name">${species.scientificName}</td>
                    <td>${species.commonNames.join(', ')}</td>
                    <td><span class="status-badge status-${species.status}">${species.status.toUpperCase()}</span></td>
                    <td>${species.confidence}%</td>
                    <td>
                        <div>
                            <span>${species.standardizedSize.value.toFixed(2)} ${species.standardizedSize.unit}</span>
                            <div style="font-size: 0.8rem; opacity: 0.7;">${species.standardizedSize.original}</div>
                        </div>
                    </td>
                    <td>${species.habitat}</td>
                    <td style="font-size: 0.85rem;">${species.citation}</td>
                    <td>${species.sourcePage}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function createSpeciesCard(species) {
            const div = document.createElement('div');
            div.className = `species-card ${species.status}`;
            
            const confidenceClass = species.confidence >= 80 ? 'high' : 
                                  species.confidence >= 60 ? 'medium' : 'low';

            div.innerHTML = `
                <div class="species-header">
                    <div class="species-name">${species.scientificName}</div>
                    <div class="common-names">${species.commonNames.join(', ')}</div>
                    <span class="status-badge status-${species.status}">${species.status.toUpperCase()}</span>
                </div>
                
                <div class="confidence-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="font-size: 0.9rem; font-weight: 500;">Confidence</span>
                        <span style="font-size: 0.9rem; font-weight: 600;">${species.confidence}%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill confidence-${confidenceClass}" style="width: ${species.confidence}%"></div>
                    </div>
                </div>

                <div class="species-details">
                    <div class="detail-grid">
                        <div class="detail-row">
                            <span class="detail-label">Author & Year:</span>
                            <span class="detail-value">${species.author} (${species.year})</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Size:</span>
                            <div class="detail-value">
                                <span>${species.standardizedSize.value.toFixed(2)} ${species.standardizedSize.unit}</span>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${species.standardizedSize.original}</div>
                            </div>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Habitat:</span>
                            <span class="detail-value">${species.habitat}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Distribution:</span>
                            <span class="detail-value">${species.distribution}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Source Page:</span>
                            <span class="detail-value">${species.sourcePage}</span>
                        </div>
                    </div>

                    <div class="citation">
                        <strong>Source:</strong> ${species.citation}
                    </div>

                    ${species.sourceQuote ? `
                        <div class="source-quote">
                            "${species.sourceQuote}"
                        </div>
                    ` : ''}
                </div>
            `;

            return div;
        }

        function updateResultsStats() {
            const verified = speciesData.filter(s => s.status === 'verified').length;
            const synonyms = speciesData.filter(s => s.status === 'synonym').length;
            const notFound = speciesData.filter(s => s.status === 'not-found').length;

            document.getElementById('verifiedCount').textContent = `${verified} Verified`;
            document.getElementById('synonymCount').textContent = `${synonyms} Synonyms`;
            document.getElementById('notFoundCount').textContent = `${notFound} Not Found`;
        }

        function populateSpeciesTable() {
            const tbody = document.getElementById('speciesTableBody');
            tbody.innerHTML = '';

            speciesData.forEach(species => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="scientific-name">${species.scientificName}</td>
                    <td>${species.commonNames.join(', ')}</td>
                    <td><span class="status-badge status-${species.status}">${species.status.toUpperCase()}</span></td>
                    <td>${species.confidence}%</td>
                    <td>
                        <div>
                            <span>${species.standardizedSize.value.toFixed(2)} ${species.standardizedSize.unit}</span>
                            <div style="font-size: 0.8rem; opacity: 0.7;">${species.standardizedSize.original}</div>
                        </div>
                    </td>
                    <td>${species.habitat}</td>
                    <td style="font-size: 0.85rem;">${species.citation}</td>
                    <td>${species.sourcePage}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateAnalytics() {
            if (!speciesData || speciesData.length === 0) return;

            const total = speciesData.length;
            const verified = speciesData.filter(s => s.status === 'verified').length;
            const successRate = Math.round((verified / total) * 100);
            
            const confidenceSum = speciesData.reduce((sum, s) => sum + s.confidence, 0);
            const avgConfidence = Math.round(confidenceSum / total);
            
            const needsReview = speciesData.filter(s => s.confidence < 60).length;

            // Update summary cards
            document.getElementById('totalProcessed').textContent = total;
            document.getElementById('successRate').textContent = `${successRate}%`;
            document.getElementById('avgConfidence').textContent = `${avgConfidence}%`;
            document.getElementById('needsReview').textContent = needsReview;

            // Update database coverage (simulated)
            const databases = [
                { id: 'worms', name: 'WoRMS' },
                { id: 'gbif', name: 'GBIF' },
                { id: 'inat', name: 'iNaturalist' },
                { id: 'obis', name: 'OBIS' }
            ];
            
            databases.forEach(db => {
                const found = Math.floor(Math.random() * total);
                const percentage = Math.round((found / total) * 100);
                
                const percentElement = document.getElementById(`${db.id}Percent`);
                const detailsElement = document.getElementById(`${db.id}Details`);
                
                if (percentElement) percentElement.textContent = `${percentage}%`;
                if (detailsElement) detailsElement.textContent = `${found} species`;
            });

            // Update confidence distribution
            const buckets = {
                excellent: speciesData.filter(s => s.confidence >= 80).length,
                good: speciesData.filter(s => s.confidence >= 60 && s.confidence < 80).length,
                fair: speciesData.filter(s => s.confidence >= 40 && s.confidence < 60).length,
                poor: speciesData.filter(s => s.confidence < 40).length
            };

            Object.entries(buckets).forEach(([bucket, count]) => {
                const countElement = document.getElementById(`${bucket}Count`);
                if (countElement) countElement.textContent = count;
            });
        }

        // Export functions
        function exportToCSV() {
            if (!speciesData.length) {
                showMessage('No data to export.', 'error');
                return;
            }

            const headers = [
                'Scientific Name',
                'Common Names',
                'Author',
                'Year',
                'Status',
                'Confidence %',
                'Size (Standard)',
                'Size (Original)',
                'Habitat',
                'Distribution',
                'Source',
                'Page',
                'Source Quote'
            ];

            const rows = speciesData.map(species => [
                species.scientificName,
                species.commonNames.join('; '),
                species.author,
                species.year,
                species.status,
                species.confidence,
                `${species.standardizedSize.value} ${species.standardizedSize.unit}`,
                species.standardizedSize.original,
                species.habitat,
                species.distribution,
                species.citation,
                species.sourcePage,
                species.sourceQuote || ''
            ]);

            const csvContent = [headers, ...rows].map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            downloadFile(csvContent, 'marine_species_analysis.csv', 'text/csv');
            showMessage('CSV exported successfully!', 'success');
        }

        function exportToExcel() {
            showMessage('Excel export functionality would be implemented with a library like SheetJS.', 'info');
        }

        function generateReport() {
            if (!speciesData.length) {
                showMessage('No data to generate report.', 'error');
                return;
            }

            const reportHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Marine Species Analysis Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
                        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
                        .species { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
                        .scientific-name { font-style: italic; font-size: 1.2em; color: #2c5aa0; font-weight: bold; }
                        .citation { background: #e3f2fd; padding: 10px; border-left: 4px solid #2196f3; margin-top: 10px; font-size: 0.9em; }
                        .quote { font-style: italic; background: #f5f5f5; padding: 10px; border-left: 3px solid #ccc; margin-top: 10px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üêö Marine Species Analysis Report</h1>
                        <p>Generated on ${new Date().toLocaleDateString()}</p>
                    </div>

                    <div class="summary">
                        <h2>üìä Summary</h2>
                        <p><strong>Total Species:</strong> ${speciesData.length}</p>
                        <p><strong>Verified:</strong> ${speciesData.filter(s => s.status === 'verified').length}</p>
                        <p><strong>Average Confidence:</strong> ${Math.round(speciesData.reduce((sum, s) => sum + s.confidence, 0) / speciesData.length)}%</p>
                    </div>

                    <h2>üìã Species Details</h2>
                    ${speciesData.map(species => `
                        <div class="species">
                            <div class="scientific-name">${species.scientificName}</div>
                            <p><strong>Common Names:</strong> ${species.commonNames.join(', ')}</p>
                            <p><strong>Author & Year:</strong> ${species.author} (${species.year})</p>
                            <p><strong>Size:</strong> ${species.standardizedSize.value} ${species.standardizedSize.unit} (${species.standardizedSize.original})</p>
                            <p><strong>Status:</strong> ${species.status.toUpperCase()} (${species.confidence}% confidence)</p>
                            <p><strong>Habitat:</strong> ${species.habitat}</p>
                            <p><strong>Distribution:</strong> ${species.distribution}</p>
                            <p><strong>Page:</strong> ${species.sourcePage}</p>
                            <div class="citation">
                                <strong>Source:</strong> ${species.citation}
                            </div>
                            ${species.sourceQuote ? `
                                <div class="quote">
                                    "${species.sourceQuote}"
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </body>
                </html>
            `;

            downloadFile(reportHTML, 'marine_species_report.html', 'text/html');
            showMessage('Report generated successfully!', 'success');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // AI Helper function
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (!message) {
                alert('Please enter a question first.');
                return;
            }
            
            // Simple AI response simulation
            const responses = [
                "That's a great question! For species verification issues, I recommend checking the original source and cross-referencing with multiple databases.",
                "To improve OCR accuracy, ensure your PDF has clear, high-contrast text. Scanned documents work better than photos.",
                "For unverified species, try searching with alternate spellings or check if it might be a synonym.",
                "The tool checks WoRMS, GBIF, iNaturalist, and OBIS. If a species isn't found, it might be newly described or have naming issues.",
                "For export options, you can download CSV for data analysis or generate HTML reports for presentations.",
                "Common issues with species identification include: misspelled names, outdated taxonomy, non-marine species, or subspecies not in databases.",
                "WoRMS is the most authoritative marine database. If a species isn't in WoRMS, double-check the spelling and taxonomic status."
            ];
            
            const response = responses[Math.floor(Math.random() * responses.length)];
            alert(`AI Helper: ${response}`);
            
            input.value = '';
        }

        // Support email functions
        function sendSupportEmail(type) {
            const subject = type === 'technical' ? 
                'Marine Species Analyzer - Technical Support Request' : 
                'Marine Species Analyzer - Development Support Request';
            
            const recipient = type === 'technical' ? 
                'aaron.kornbluth@gmail.com' : 
                'jakespencer6596@gmail.com';
            
            const body = `Hello ${type === 'technical' ? 'Aaron' : 'Jake'},

I need help with the Marine Species Analyzer tool. 

Issue Description:
[Please describe your issue or question here]

Browser: ${navigator.userAgent}
Tool Version: 1.0
Current Language: ${currentLanguage}
Species Data Count: ${speciesData.length}

Thank you for your assistance!

Best regards,
[Your name]`;

            const mailtoLink = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoLink);
        }

        // Message display functions
        function showMessage(message, type) {
            const container = document.getElementById('processingResults');
            container.innerHTML = `<div class="message ${type}">${message}</div>`;
        }

        function showProcessingMessage(message, type) {
            const container = document.getElementById('processingResults');
            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="message ${type}">${message}</div>
                </div>
            `;
        }
    </script>
</body>
</html>
